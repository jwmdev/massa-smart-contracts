"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.trySafeExecute = void 0;
const time_1 = require("./time");
const MAX_NUMBER_RETRIALS = 5;
/**
 * Tries to execute a function and retries if it fails.
 *
 * @param func - The function to execute
 * @param args - The arguments to pass to the function (optional)
 * @param retryTimes - The number of times to retry (default: 5)
 *
 * @throws If the function is not defined or if it fails after the number of retries
 *
 * @returns The result of the function upon successful execution
 */
const trySafeExecute = async (func, args, retryTimes = MAX_NUMBER_RETRIALS) => {
    args = args || [null, {}];
    if (!func)
        throw new Error(`Function execution init conditions are erroneous: ${func}`);
    let failureCounter = 0;
    let res = null;
    while (true) {
        try {
            res = await func(...args);
            break;
        }
        catch (ex) {
            const msg = `Failed to execute function ${func.name}. Retrying for ${++failureCounter}th time in 1s.`;
            console.error(msg);
            await (0, time_1.wait)(200 * (failureCounter + 1));
            if (failureCounter === retryTimes) {
                throw ex;
            }
        }
    }
    return res;
};
exports.trySafeExecute = trySafeExecute;
//# sourceMappingURL=retryExecuteFunction.js.map